require('dotenv').config(); // Load environment variables from .env file
const axios = require('axios');
const router = require('express').Router(); // Import the Router from express

// Your route handler
router.get('/', withAuth, async (req, res) => {
  try {
    // Make a GET request to the API using Axios
    const apiKey = process.env.COMPANION_PLANTS_API_KEY; // Replace with your API key from .env
    const speciesId = '1'; // Replace with the actual species ID you want to fetch
    const apiUrl = `https://perenual.com/api/hardiness-map?species_id=${speciesId}&key=${apiKey}`;

    const response = await axios.get(apiUrl);
    const mapData = response.data; // Assuming the API response is JSON data

    // Render the template with the fetched data
    res.render('homepage', {
      plantHardinessMap: mapData, // Update the variable name here
      logged_in: req.session.logged_in,
    });
  } catch (err) {
    res.status(500).json(err);
  }
});

module.exports = router; 


